<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador Zod√≠aco Chino Pro</title>
    <style>
        /* Estilos base mejorados */
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #2ecc71;
            --background: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            background: var(--background);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-group {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .comparison-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .compatibility-card {
            padding: 1.5rem;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #eee;
        }

        .compatibility-meter {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s ease;
        }

        .day-compatibility {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 2rem;">Comparador de Compatibilidad Zod√≠aco Chino Pro</h1>
    
    <div class="container">
        <div class="input-group">
            <h3>Fecha 1</h3>
            <input type="date" id="birthdate1" class="date-input" required>
            <div class="result" id="result1">
                <!-- Contenido de resultados -->
            </div>
        </div>

        <div class="input-group">
            <h3>Fecha 2</h3>
            <input type="date" id="birthdate2" class="date-input" required>
            <div class="result" id="result2">
                <!-- Contenido de resultados -->
            </div>
        </div>
    </div>

    <div class="comparison-section">
        <h2>An√°lisis Avanzado de Compatibilidad</h2>
        
        <div class="input-group" style="margin: 1.5rem 0;">
            <h3>Fecha de Encuentro</h3>
            <input type="date" id="meetingDate" required>
        </div>

        <button type="button" id="compareBtn">Calcular Compatibilidad Completa</button>
        
        <div id="comparisonResult" style="display: none;">
            <div class="compatibility-grid">
                <!-- Secci√≥n de compatibilidad anual -->
                <div class="compatibility-card">
                    <h4>Compatibilidad Anual con Fecha 1</h4>
                    <div class="compatibility-meter">
                        <div class="meter-fill" id="meterYear1"></div>
                    </div>
                    <div id="detailsYear1"></div>
                </div>

                <div class="compatibility-card">
                    <h4>Compatibilidad Anual con Fecha 2</h4>
                    <div class="compatibility-meter">
                        <div class="meter-fill" id="meterYear2"></div>
                    </div>
                    <div id="detailsYear2"></div>
                </div>

                <!-- Secci√≥n de compatibilidad diaria -->
                <div class="day-compatibility">
                    <h3>Compatibilidad Diaria Espec√≠fica</h3>
                    <div class="compatibility-grid">
                        <div class="compatibility-card">
                            <h4>D√≠a de Encuentro vs Fecha 1</h4>
                            <div class="compatibility-meter">
                                <div class="meter-fill" id="meterDay1"></div>
                            </div>
                            <div id="detailsDay1"></div>
                        </div>

                        <div class="compatibility-card">
                            <h4>D√≠a de Encuentro vs Fecha 2</h4>
                            <div class="compatibility-meter">
                                <div class="meter-fill" id="meterDay2"></div>
                            </div>
                            <div id="detailsDay2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Base de datos zodiacal
        const zodiacData = [
            { // 0 - Rata
                animal: 'Rata',
                chinese: 'Èº† (Sh«î)',
                best: ['Drag√≥n', 'Mono'],
                good: ['Buey', 'Tigre', 'Conejo', 'Serpiente', 'Perro', 'Cerdo'],
                avoid: ['Caballo', 'Cabra']
            },
            { // 1 - Buey
                animal: 'Buey',
                chinese: 'Áâõ (Ni√∫)',
                best: ['Serpiente', 'Gallo'],
                good: ['Rata', 'Tigre', 'Conejo', 'Drag√≥n', 'Mono', 'Cerdo'],
                avoid: ['Cabra', 'Caballo', 'Perro']
            },
            { // 2 - Tigre
                animal: 'Tigre',
                chinese: 'Ëôé (H«î)',
                best: ['Caballo', 'Perro'],
                good: ['Rata', 'Buey', 'Conejo', 'Drag√≥n', 'Serpiente', 'Cabra', 'Mono', 'Cerdo'],
                avoid: ['Mono']
            },
            { // 3 - Conejo
                animal: 'Conejo',
                chinese: 'ÂÖî (T√π)',
                best: ['Cabra', 'Cerdo'],
                good: ['Rata', 'Buey', 'Tigre', 'Drag√≥n', 'Serpiente', 'Perro'],
                avoid: ['Gallo']
            },
            { // 4 - Drag√≥n
                animal: 'Drag√≥n',
                chinese: 'Èæô (L√≥ng)',
                best: ['Rata', 'Mono'],
                good: ['Tigre', 'Conejo', 'Serpiente', 'Caballo', 'Cabra', 'Gallo', 'Perro', 'Cerdo'],
                avoid: ['Perro']
            },
            { // 5 - Serpiente
                animal: 'Serpiente',
                chinese: 'Ëõá (Sh√©)',
                best: ['Buey', 'Gallo'],
                good: ['Rata', 'Tigre', 'Conejo', 'Drag√≥n', 'Caballo', 'Cabra', 'Perro', 'Cerdo'],
                avoid: ['Cerdo']
            },
            { // 6 - Caballo
                animal: 'Caballo',
                chinese: 'È©¨ (M«é)',
                best: ['Tigre', 'Perro'],
                good: ['Drag√≥n', 'Serpiente', 'Cabra', 'Mono', 'Gallo', 'Cerdo'],
                avoid: ['Rata', 'Buey', 'Conejo']
            },
            { // 7 - Cabra
                animal: 'Cabra',
                chinese: 'Áæä (Y√°ng)',
                best: ['Conejo', 'Cerdo'],
                good: ['Tigre', 'Drag√≥n', 'Serpiente', 'Caballo', 'Mono', 'Gallo', 'Perro'],
                avoid: ['Buey', 'Rata']
            },
            { // 8 - Mono
                animal: 'Mono',
                chinese: 'Áå¥ (H√≥u)',
                best: ['Rata', 'Drag√≥n'],
                good: ['Buey', 'Tigre', 'Conejo', 'Serpiente', 'Caballo', 'Cabra', 'Perro', 'Cerdo'],
                avoid: ['Tigre']
            },
            { // 9 - Gallo
                animal: 'Gallo',
                chinese: 'È∏° (Jƒ´)',
                best: ['Buey', 'Serpiente'],
                good: ['Tigre', 'Conejo', 'Drag√≥n', 'Caballo', 'Cabra', 'Mono', 'Perro', 'Cerdo'],
                avoid: ['Conejo']
            },
            { // 10 - Perro
                animal: 'Perro',
                chinese: 'Áãó (G«íu)',
                best: ['Tigre', 'Caballo'],
                good: ['Rata', 'Conejo', 'Drag√≥n', 'Serpiente', 'Cabra', 'Mono', 'Gallo', 'Cerdo'],
                avoid: ['Drag√≥n', 'Buey', 'Cabra']
            },
            { // 11 - Cerdo
                animal: 'Cerdo',
                chinese: 'Áå™ (Zh≈´)',
                best: ['Conejo', 'Cabra'],
                good: ['Rata', 'Buey', 'Tigre', 'Drag√≥n', 'Serpiente', 'Mono', 'Gallo', 'Perro'],
                avoid: ['Serpiente']
            }
        ];

        // Sistema de almacenamiento
        const STORAGE_KEY = 'chineseNewYearsData';
        let chineseNewYears = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        // Base de datos hist√≥rica (1724-2024)
        const initializeDatabase = () => {
            const presetDates = {
                1724: '1724-02-14',
    1725: '1725-02-03',
    1726: '1726-01-24',
    1727: '1727-02-11',
    1728: '1728-02-01',
    1729: '1729-02-19',
    1730: '1730-02-08',
    1731: '1731-01-28',
    1732: '1732-02-16',
    1733: '1733-02-05',
    1734: '1734-01-26',
    1735: '1735-02-13',
    1736: '1736-02-02',
    1737: '1737-02-20',
    1738: '1738-02-09',
    1739: '1739-01-30',
    1740: '1740-02-18',
    1741: '1741-02-06',
    1742: '1742-01-27',
    1743: '1743-02-15',
    1744: '1744-02-04',
    1745: '1745-01-24',
    1746: '1746-02-12',
    1747: '1747-02-01',
    1748: '1748-02-20',
    1749: '1749-02-08',
    1750: '1750-01-29',
    1751: '1751-02-16',
    1752: '1752-02-05',
    1753: '1753-01-25',
    1754: '1754-02-13',
    1755: '1755-02-02',
    1756: '1756-02-21',
    1757: '1757-02-09',
    1758: '1758-01-30',
    1759: '1759-02-17',
    1760: '1760-02-06',
    1761: '1761-01-26',
    1762: '1762-02-14',
    1763: '1763-02-03',
    1764: '1764-01-24',
    1765: '1765-02-11',
    1766: '1766-01-31',
    1767: '1767-02-19',
    1768: '1768-02-08',
    1769: '1769-01-28',
    1770: '1770-02-16',
    1771: '1771-02-05',
    1772: '1772-01-26',
    1773: '1773-02-13',
    1774: '1774-02-02',
    1775: '1775-02-20',
    1776: '1776-02-09',
    1777: '1777-01-29',
    1778: '1778-02-17',
    1779: '1779-02-06',
    1780: '1780-01-27',
    1781: '1781-02-14',
    1782: '1782-02-03',
    1783: '1783-01-24',
    1784: '1784-02-12',
    1785: '1785-01-31',
    1786: '1786-02-19',
    1787: '1787-02-08',
    1788: '1788-01-28',
    1789: '1789-02-15',
    1790: '1790-02-05',
    1791: '1791-01-26',
    1792: '1792-02-13',
    1793: '1793-02-01',
    1794: '1794-02-20',
    1795: '1795-02-09',
    1796: '1796-01-30',
    1797: '1797-02-17',
    1798: '1798-02-06',
    1799: '1799-01-27',
    1800: '1800-02-14',
    1801: '1801-02-02',
    1802: '1802-01-23',
    1803: '1803-02-11',
    1804: '1804-01-31',
    1805: '1805-02-19',
    1806: '1806-02-08',
    1807: '1807-01-28',
    1808: '1808-02-16',
    1809: '1809-02-04',
    1810: '1810-01-25',
    1811: '1811-02-13',
    1812: '1812-02-02',
    1813: '1813-02-20',
    1814: '1814-02-09',
    1815: '1815-01-30',
    1816: '1816-02-17',
    1817: '1817-02-05',
    1818: '1818-01-26',
    1819: '1819-02-14',
    1820: '1820-02-03',
    1821: '1821-01-23',
    1822: '1822-02-11',
    1823: '1823-01-31',
    1824: '1824-02-19',
    1825: '1825-02-08',
    1826: '1826-01-28',
    1827: '1827-02-16',
    1828: '1828-02-05',
    1829: '1829-01-25',
    1830: '1830-02-13',
    1831: '1831-02-02',
    1832: '1832-02-21',
    1833: '1833-02-09',
    1834: '1834-01-30',
    1835: '1835-02-17',
    1836: '1836-02-06',
    1837: '1837-01-26',
    1838: '1838-02-14',
    1839: '1839-02-03',
    1840: '1840-01-24',
    1841: '1841-02-11',
    1842: '1842-01-31',
    1843: '1843-02-19',
    1844: '1844-02-08',
    1845: '1845-01-28',
    1846: '1846-02-16',
    1847: '1847-02-05',
    1848: '1848-01-26',
    1849: '1849-02-13',
    1850: '1850-02-02',
    1851: '1851-02-20',
    1852: '1852-02-09',
    1853: '1853-01-30',
    1854: '1854-02-17',
    1855: '1855-02-06',
    1856: '1856-01-27',
    1857: '1857-02-14',
    1858: '1858-02-03',
    1859: '1859-01-24',
    1860: '1860-02-12',
    1861: '1861-01-31',
    1862: '1862-02-19',
    1863: '1863-02-08',
    1864: '1864-01-28',
    1865: '1865-02-15',
    1866: '1866-02-05',
    1867: '1867-01-26',
    1868: '1868-02-13',
    1869: '1869-02-01',
    1870: '1870-02-20',
    1871: '1871-02-09',
    1872: '1872-01-30',
    1873: '1873-02-17',
    1874: '1874-02-06',
    1875: '1875-01-27',
    1876: '1876-02-14',
    1877: '1877-02-02',
    1878: '1878-01-23',
    1879: '1879-02-11',
    1880: '1880-01-31',
    1881: '1881-02-19',
    1882: '1882-02-08',
    1883: '1883-01-28',
    1884: '1884-02-16',
    1885: '1885-02-04',
    1886: '1886-01-25',
    1887: '1887-02-13',
    1888: '1888-02-02',
    1889: '1889-02-20',
    1890: '1890-02-09',
    1891: '1891-01-30',
    1892: '1892-02-17',
    1893: '1893-02-05',
    1894: '1894-01-26',
    1895: '1895-02-14',
    1896: '1896-02-03',
    1897: '1897-01-23',
    1898: '1898-02-11',
    1899: '1899-01-31',
    1900: '1900-01-31',
    1901: '1901-02-19',
    1902: '1902-02-08',
    1903: '1903-01-29',
    1904: '1904-02-16',
    1905: '1905-02-04',
    1906: '1906-01-25',
    1907: '1907-02-13',
    1908: '1908-02-02',
    1909: '1909-01-22',
    1910: '1910-02-10',
    1911: '1911-01-30',
    1912: '1912-02-18',
    1913: '1913-02-06',
    1914: '1914-01-26',
    1915: '1915-02-14',
    1916: '1916-02-03',
    1917: '1917-01-23',
    1918: '1918-02-11',
    1919: '1919-02-01',
    1920: '1920-02-20',
    1921: '1921-02-08',
    1922: '1922-01-28',
    1923: '1923-02-16',
    1924: '1924-02-05',
    1925: '1925-01-24',
    1926: '1926-02-13',
    1927: '1927-02-02',
    1928: '1928-01-23',
    1929: '1929-02-10',
    1930: '1930-01-30',
    1931: '1931-02-17',
    1932: '1932-02-06',
    1933: '1933-01-26',
    1934: '1934-02-14',
    1935: '1935-02-04',
    1936: '1936-01-24',
    1937: '1937-02-11',
    1938: '1938-01-31',
    1939: '1939-02-19',
    1940: '1940-02-08',
    1941: '1941-01-27',
    1942: '1942-02-15',
    1943: '1943-02-05',
    1944: '1944-01-25',
    1945: '1945-02-13',
    1946: '1946-02-02',
    1947: '1947-01-22',
    1948: '1948-02-10',
    1949: '1949-01-29',
    1950: '1950-02-17',
    1951: '1951-02-06',
    1952: '1952-01-27',
    1953: '1953-02-14',
    1954: '1954-02-03',
    1955: '1955-01-24',
    1956: '1956-02-12',
    1957: '1957-01-31',
    1958: '1958-02-18',
    1959: '1959-02-08',
    1960: '1960-01-28',
    1961: '1961-02-15',
    1962: '1962-02-05',
    1963: '1963-01-25',
    1964: '1964-02-13',
    1965: '1965-02-02',
    1966: '1966-01-21',
    1967: '1967-02-09',
    1968: '1968-01-30',
    1969: '1969-02-17',
    1970: '1970-02-06',
    1971: '1971-01-27',
    1972: '1972-02-15',
    1973: '1973-02-03',
    1974: '1974-01-23',
    1975: '1975-02-11',
    1976: '1976-01-31',
    1977: '1977-02-18',
    1978: '1978-02-07',
    1979: '1979-01-28',
    1980: '1980-02-16',
    1981: '1981-02-05',
    1982: '1982-01-25',
    1983: '1983-02-13',
    1984: '1984-02-02',
    1985: '1985-02-20',
    1986: '1986-02-09',
    1987: '1987-01-29',
    1988: '1988-02-17',
    1989: '1989-02-06',
    1990: '1990-01-27',
    1991: '1991-02-15',
    1992: '1992-02-04',
    1993: '1993-01-23',
    1994: '1994-02-10',
    1995: '1995-01-31',
    1996: '1996-02-19',
    1997: '1997-02-07',
    1998: '1998-01-28',
    1999: '1999-02-16',
    2000: '2000-02-05',
    2001: '2001-01-24',
    2002: '2002-02-12',
    2003: '2003-02-01',
    2004: '2004-01-22',
    2005: '2005-02-09',
    2006: '2006-01-29',
    2007: '2007-02-18',
    2008: '2008-02-07',
    2009: '2009-01-26',
    2010: '2010-02-14',
    2011: '2011-02-03',
    2012: '2012-01-23',
    2013: '2013-02-10',
    2014: '2014-01-31',
    2015: '2015-02-19',
    2016: '2016-02-08',
    2017: '2017-01-28',
    2018: '2018-02-16',
    2019: '2019-02-05',
    2020: '2020-01-25',
    2021: '2021-02-12',
    2022: '2022-02-01',
    2023: '2023-01-22',
    2024: '2024-02-10',
    2025: '2025-01-29'
            };
            
            chineseNewYears = {...presetDates, ...chineseNewYears};
            localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
        };

        // Estimaci√≥n de a√±o nuevo chino
        const estimateChineseNewYear = (year) => {
            const baseDate = new Date(year, 0, 21);
            const cycle = (year - 1900) % 19;
            const estimation = new Date(baseDate.setDate(21 + cycle));
            return estimation.getMonth() === 0 ? 
                new Date(year, 0, Math.min(estimation.getDate(), 31)) :
                new Date(year, 1, Math.min(estimation.getDate(), 20));
        };

        // C√°lculo zodiacal principal
        const getZodiac = (date) => {
            const year = date.getFullYear();
            
            if(year < 1724 || year > 2100) {
                throw new Error('A√±o fuera de rango (1724-2100)');
            }

            let cnDate = chineseNewYears[year] 
                ? new Date(chineseNewYears[year]) 
                : estimateChineseNewYear(year);

            if(!chineseNewYears[year]) {
                chineseNewYears[year] = cnDate.toISOString().split('T')[0];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
            }

            const zodiacYear = date < cnDate ? year - 1 : year;
            const zodiacIndex = ((zodiacYear - 1900) % 12 + 12) % 12;

            if(zodiacIndex < 0 || zodiacIndex >= zodiacData.length) {
                throw new Error('Error en c√°lculo zodiacal');
            }

            return {
                ...zodiacData[zodiacIndex],
                exactDate: !!chineseNewYears[year]
            };
        };

          // Funci√≥n de compatibilidad √öNICA (eliminar versiones anteriores)
        const calculateCompatibility = (zodiacA, zodiacB) => {
            const compatibilityMatrix = {
                best: 100,
                good: 75,
                neutral: 50,
                avoid: 25
            };

            const getCompatibilityType = (source, target) => {
                if (source.best.includes(target.animal)) return 'best';
                if (source.good.includes(target.animal)) return 'good';
                if (source.avoid.includes(target.animal)) return 'avoid';
                return 'neutral';
            };

            const compatAToB = getCompatibilityType(zodiacA, zodiacB);
            const compatBToA = getCompatibilityType(zodiacB, zodiacA);

            const score = (compatibilityMatrix[compatAToB] + compatibilityMatrix[compatBToA]) / 2;
            
            const descriptions = {
                best: 'üåü Compatibilidad Excelente',
                good: '‚úÖ Buena Conexi√≥n',
                neutral: '‚öñÔ∏è Compatibilidad Neutral',
                avoid: '‚ö†Ô∏è Desaf√≠os Potenciales'
            };

            const overall = score >= 85 ? 'best' :
                          score >= 60 ? 'good' :
                          score >= 40 ? 'neutral' : 'avoid';

            return {
                score,
                description: descriptions[overall],
                details: [
                    `${zodiacA.animal} ‚Üí ${zodiacB.animal}: ${compatAToB}`,
                    `${zodiacB.animal} ‚Üí ${zodiacA.animal}: ${compatBToA}`
                ]
            };
        };


            // Verificar compatibilidad en ambas direcciones
            const checkCompatibility = (a, b) => {
                if(a.best.includes(b.animal)) return 'best';
                if(a.good.includes(b.animal)) return 'good';
                if(a.avoid.includes(b.animal)) return 'avoid';
                return 'neutral';
            };

            const compat1 = checkCompatibility(zodiac1, zodiac2);
            const compat2 = checkCompatibility(zodiac2, zodiac1);

            // Calcular puntaje promedio
            const score = (compatibilityTypes[compat1] + compatibilityTypes[compat2]) / 2;
            
            // Generar descripci√≥n
            const descriptions = {
                best: 'Excelente compatibilidad',
                good: 'Buena compatibilidad',
                neutral: 'Compatibilidad neutral',
                avoid: 'Compatibilidad baja'
            };

            const overall = score >= 85 ? 'best' :
                          score >= 60 ? 'good' :
                          score >= 40 ? 'neutral' : 'avoid';

            return {
                score,
                description: descriptions[overall],
                details: [
                    `Fecha 1 (${zodiac1.animal}) ‚Üí Fecha 2 (${zodiac2.animal}): ${compat1}`,
                    `Fecha 2 (${zodiac2.animal}) ‚Üí Fecha 1 (${zodiac1.animal}): ${compat2}`
                ]
            };
        };

        // Modificar handleCalculation para manejar ambas fechas
        const handleCalculation = (dateInputId, resultId) => {
            try {
                const dateInput = document.getElementById(dateInputId).value;
                if(!dateInput) throw new Error('Selecciona una fecha');
                
                const result = getZodiac(new Date(dateInput));
                
                // Actualizar UI espec√≠fica
                const resultElement = document.getElementById(resultId);
                resultElement.querySelector('#zodiac-animal').textContent = result.animal;
                resultElement.querySelector('#zodiac-chinese').textContent = result.chinese;
                resultElement.querySelector('#best-matches').textContent = result.best.join(', ');
                resultElement.querySelector('#good-matches').textContent = result.good.join(', ');
                resultElement.querySelector('#avoid-matches').textContent = result.avoid.join(', ');
                
                resultElement.style.display = 'block';

            } catch(error) {
                document.getElementById(resultId).style.display = 'none';
                alert(error.message);
            }
        };
        const getDayZodiac = (date) => {
            const baseDate = new Date(1900, 0, 1); // 1 Enero 1900 fue Rata
            const diffDays = Math.floor((date - baseDate) / (1000 * 60 * 60 * 24));
            const dayIndex = (diffDays % 12 + 12) % 12;
            return zodiacData[dayIndex];
        };

        // Manejador de comparaci√≥n actualizado (sin duplicados)
        const handleComparison = () => {
            try {
                const date1 = document.getElementById('birthdate1').value;
                const date2 = document.getElementById('birthdate2').value;
                const meetingDate = document.getElementById('meetingDate').value;
                
                if (!date1 || !date2 || !meetingDate) {
                    throw new Error('Selecciona todas las fechas requeridas');
                }

                const zodiac1 = getZodiac(new Date(date1));
                const zodiac2 = getZodiac(new Date(date2));
                const meetingZodiacYear = getZodiac(new Date(meetingDate));
                const meetingZodiacDay = getDayZodiac(new Date(meetingDate));

                // Calcular compatibilidades
                const compatYear1 = calculateCompatibility(meetingZodiacYear, zodiac1);
                const compatYear2 = calculateCompatibility(meetingZodiacYear, zodiac2);
                const compatDay1 = calculateCompatibility(meetingZodiacDay, zodiac1);
                const compatDay2 = calculateCompatibility(meetingZodiacDay, zodiac2);

                // Actualizar UI
                const updateCompatibilityUI = (meterId, detailsId, compatibility) => {
                    document.getElementById(meterId).style.width = `${compatibility.score}%`;
                    document.getElementById(detailsId).innerHTML = `
                        <p>${compatibility.description}</p>
                        <ul>${compatibility.details.map(d => `<li>${d}</li>`).join('')}</ul>
                    `;
                };

                updateCompatibilityUI('meterYear1', 'detailsYear1', compatYear1);
                updateCompatibilityUI('meterYear2', 'detailsYear2', compatYear2);
                updateCompatibilityUI('meterDay1', 'detailsDay1', compatDay1);
                updateCompatibilityUI('meterDay2', 'detailsDay2', compatDay2);

                document.getElementById('comparisonResult').style.display = 'block';

            } catch(error) {
                alert(error.message);
            }
        };

        // Inicializaci√≥n final (sin duplicados)
        if(!window.initialized) {
            initializeDatabase();
            document.getElementById('compareBtn').addEventListener('click', handleComparison);
            document.querySelectorAll('.date-input').forEach(input => {
                input.addEventListener('change', () => {
                    const resultId = input.id.replace('birthdate', 'result');
                    handleCalculation(input.id, resultId);
                });
            });
            window.initialized = true;
        }
</script>
</body>
</html>
