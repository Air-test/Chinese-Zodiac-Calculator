<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Zod√≠aco Chino Pro</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #2ecc71;
            --background: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            background: var(--background);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-group {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .comparison-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .compatibility-card {
            padding: 1.5rem;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #eee;
        }

        .compatibility-meter {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s ease;
        }

        .day-compatibility {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
        }

        #errorMsg {
            color: #dc3545;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
            background: #fff3f3;
            border-radius: 5px;
        }

.numerology-section {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        margin-top: 2rem;
    }

    .numerology-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
    }

    .numerology-card {
        text-align: center;
        padding: 1.5rem;
        border: 1px solid #eee;
        border-radius: 8px;
    }

    .number-result {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary);
        margin: 1rem 0;
    }

    .numerology-analysis {
        margin-top: 2rem;
    }

    .analysis-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }

    .percentage-bar {
        height: 20px;
        background: #ff4444;
        border-radius: 10px;
        overflow: hidden;
        display: flex;
        margin: 1rem 0;
    }

    .favorable {
        background: #00C851;
        height: 100%;
        transition: width 0.5s ease;
    }

    .unfavorable {
        background: #ff4444;
        height: 100%;
        flex-grow: 1;
    }
        
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 2rem;">Analizador Zod√≠aco Chino Pro</h1>
    
    <div class="container">
        <div class="input-group">
            <h3>Fecha 1</h3>
            <input type="date" id="birthdate1" class="date-input" required>
            <div class="result" id="result1">
                <p><strong>A√±o de:</strong> <span id="zodiac-animal1"></span></p>
                <p><strong>Nombre Chino:</strong> <span id="zodiac-chinese1"></span></p>
            </div>
        </div>

        <div class="input-group">
            <h3>Fecha 2</h3>
            <input type="date" id="birthdate2" class="date-input" required>
            <div class="result" id="result2">
                <p><strong>A√±o de:</strong> <span id="zodiac-animal2"></span></p>
                <p><strong>Nombre Chino:</strong> <span id="zodiac-chinese2"></span></p>
            </div>
        </div>
    </div>

    <div class="comparison-section">
        <h2>An√°lisis Avanzado</h2>
        
        <div class="input-group">
            <h3>Fecha de Encuentro</h3>
            <input type="date" id="meetingDate" required>
        </div>

        <button type="button" id="compareBtn" style="margin-top: 1rem;">Calcular Compatibilidad Completa</button>
        <div id="errorMsg"></div>
        
        <div id="comparisonResult" style="display: none;">
            <div class="compatibility-grid">
                <div class="compatibility-card">
                    <h4>üìÖ Compatibilidad Anual con Fecha 1</h4>
                    <div class="compatibility-meter">
                        <div class="meter-fill" id="meterYear1"></div>
                    </div>
                    <div id="detailsYear1"></div>
                </div>

                <div class="compatibility-card">
                    <h4>üìÖ Compatibilidad Anual con Fecha 2</h4>
                    <div class="compatibility-meter">
                        <div class="meter-fill" id="meterYear2"></div>
                    </div>
                    <div id="detailsYear2"></div>
                </div>

                <div class="day-compatibility">
                    <h3>üóìÔ∏è Compatibilidad Diaria Espec√≠fica</h3>
                    <div class="compatibility-grid">
                        <div class="compatibility-card">
                            <h4>üåû D√≠a vs Fecha 1</h4>
                            <div class="compatibility-meter">
                                <div class="meter-fill" id="meterDay1"></div>
                            </div>
                            <div id="detailsDay1"></div>
                        </div>

                        <div class="compatibility-card">
                            <h4>üåô D√≠a vs Fecha 2</h4>
                            <div class="compatibility-meter">
                                <div class="meter-fill" id="meterDay2"></div>
                            </div>
                            <div id="detailsDay2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="numerology-section">
    <h2>Numerolog√≠a</h2>
    
    <div class="numerology-grid">
        <div class="numerology-card">
            <h3>D√≠a</h3>
            <div id="dayNumber" class="number-result">-</div>
            <p id="dayCalculation"></p>
        </div>
        
        <div class="numerology-card">
            <h3>Fecha</h3>
            <div id="dateNumber" class="number-result">-</div>
            <p id="dateCalculation"></p>
        </div>
    </div>

    <div class="numerology-analysis">
        <h3>Porcentaje de Numerolog√≠a</h3>
        <div class="analysis-container">
            <div class="analysis-item">
                <h4>Fecha 1</h4>
                <div class="percentage-bar">
                    <div class="favorable" id="fav1"></div>
                    <div class="unfavorable" id="unfav1"></div>
                </div>
                <p id="numerologyResult1"></p>
            </div>
            
            <div class="analysis-item">
                <h4>Fecha 2</h4>
                <div class="percentage-bar">
                    <div class="favorable" id="fav2"></div>
                    <div class="unfavorable" id="unfav2"></div>
                </div>
                <p id="numerologyResult2"></p>
            </div>
        </div>
    </div>
</div>

    <script>
        (function(){
            'use strict';
            
            const zodiacData = [
                { animal: 'Rata', chinese: 'Èº† (Sh«î)', best: ['Drag√≥n', 'Buey', 'Conejo' ], good: ['Mono','Tigre',  'Serpiente', 'Cerdo', 'Perro','Rata'], avoid: ['Caballo', 'Cabra', 'Gallo'] },
                { animal: 'Buey', chinese: 'Áâõ (Ni√∫)', best: [ 'Mono', 'Gallo','Rata'], good: [ 'Conejo','Serpiente', 'Perro', 'Buey'], avoid: ['Tigre', 'Cabra', 'Caballo', 'Cerdo', 'Drag√≥n'] },
                { animal: 'Tigre', chinese: 'Ëôé (H«î)', best: ['Caballo','Drag√≥n', 'Cerdo'], good: ['Rata', 'Conejo', 'Cabra', 'Perro',  'Gallo'], avoid: ['Mono', 'Tigre', 'Buey',  'Serpiente'] },
                { animal: 'Conejo', chinese: 'ÂÖî (T√π)', best: ['Rata','Cabra', 'Cerdo', 'Perro', 'Mono'], good: [ 'Buey', 'Tigre', 'Conejo', 'Drag√≥n', 'Caballo'], avoid: ['Gallo', 'Serpiente'] },
                { animal: 'Drag√≥n', chinese: 'Èæô (L√≥ng)', best: ['Tigre','Rata', 'Serpiente'], good: [ 'Conejo', 'Caballo', 'Gallo', 'Perro', 'Cerdo',  'Mono'], avoid: ['Perro', 'Cabra', 'Buey'] },
                { animal: 'Serpiente', chinese: 'Ëõá (Sh√©)', best: [ 'Gallo', 'Drag√≥n'], good: ['Buey','Rata', 'Caballo', 'Mono','Perro'], avoid: ['Cerdo', 'Tigre', 'Conejo', 'Cabra', 'Serpiente'] },
                { animal: 'Caballo', chinese: 'È©¨ (M«é)', best: ['Tigre', 'Cabra'], good: ['Drag√≥n', 'Serpiente', 'Mono', 'Cerdo', 'Conejo', 'Perro'], avoid: ['Rata', 'Buey', 'Gallo', 'Caballo'] },
                { animal: 'Cabra', chinese: 'Áæä (Y√°ng)', best: ['Conejo', 'Cerdo', 'Caballo'], good: ['Tigre', 'Mono', 'Gallo', 'Cabra'], avoid: ['Buey', 'Rata', 'Drag√≥n', 'Serpiente', 'Perro'] },
                { animal: 'Mono', chinese: 'Áå¥ (H√≥u)', best: ['Buey', 'Conejo'], good: ['Serpiente', 'Caballo', 'Cabra', 'Perro', 'Rata', 'Drag√≥n','Mono','Gallo'], avoid: ['Tigre', 'Cerdo'] },
                { animal: 'Gallo', chinese: 'È∏° (Jƒ´)', best: ['Buey', 'Serpiente'], good: ['Tigre', 'Drag√≥n', 'Cabra', 'Mono', 'Cerdo'], avoid: ['Conejo', 'Gallo', 'Perro', 'Conejo', 'Caballo'] },
                { animal: 'Perro', chinese: 'Áãó (G«íu)', best: ['Conejo'], good: ['Rata', 'Serpiente', 'Mono', 'Cerdo', 'Tigre', 'Caballo', 'Perro'], avoid: ['Drag√≥n', 'Buey', 'Cabra', 'Gallo'] },
                { animal: 'Cerdo', chinese: 'Áå™ (Zh≈´)', best: ['Tigre','Conejo', 'Cabra'], good: ['Rata',  'Drag√≥n', 'Gallo', 'Perro', 'Cerdo', 'Caballo'], avoid: ['Serpiente', 'Buey', 'Mono'] }
            ];
            const numerologyData = {
    'Rata': { best: [2,3], avoid: [5,9] },
    'Buey': { best: [1,4], avoid: [5,6] },
    'Tigre': { best: [1,3,4], avoid: [6,7,8] },
    'Conejo': { best: [3,4,6], avoid: [1,7,8] },
    'Drag√≥n': { best: [1,6,7], avoid: [3,8] },
    'Serpiente': { best: [2,8,9], avoid: [1,6,7] },
    'Caballo': { best: [2,3,7], avoid: [1,5,6] },
    'Cabra': { best: [2,7], avoid: [4,9] },
    'Mono': { best: [4,9], avoid: [2,7] },
    'Gallo': { best: [5,7,8], avoid: [1,3,9] },
    'Perro': { best: [3,4,9], avoid: [1,6,7] },
    'Cerdo': { best: [2,5,8], avoid: [1,7] }
};

            const STORAGE_KEY = 'chineseNewYearsData';
            let chineseNewYears = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

            const initializeDatabase = () => {
                const presetDates = {
                    /* Tus datos hist√≥ricos completos de a√±os */
                    1724: '1724-02-14',
    1725: '1725-02-03',
    1726: '1726-01-24',
    1727: '1727-02-11',
    1728: '1728-02-01',
    1729: '1729-02-19',
    1730: '1730-02-08',
    1731: '1731-01-28',
    1732: '1732-02-16',
    1733: '1733-02-05',
    1734: '1734-01-26',
    1735: '1735-02-13',
    1736: '1736-02-02',
    1737: '1737-02-20',
    1738: '1738-02-09',
    1739: '1739-01-30',
    1740: '1740-02-18',
    1741: '1741-02-06',
    1742: '1742-01-27',
    1743: '1743-02-15',
    1744: '1744-02-04',
    1745: '1745-01-24',
    1746: '1746-02-12',
    1747: '1747-02-01',
    1748: '1748-02-20',
    1749: '1749-02-08',
    1750: '1750-01-29',
    1751: '1751-02-16',
    1752: '1752-02-05',
    1753: '1753-01-25',
    1754: '1754-02-13',
    1755: '1755-02-02',
    1756: '1756-02-21',
    1757: '1757-02-09',
    1758: '1758-01-30',
    1759: '1759-02-17',
    1760: '1760-02-06',
    1761: '1761-01-26',
    1762: '1762-02-14',
    1763: '1763-02-03',
    1764: '1764-01-24',
    1765: '1765-02-11',
    1766: '1766-01-31',
    1767: '1767-02-19',
    1768: '1768-02-08',
    1769: '1769-01-28',
    1770: '1770-02-16',
    1771: '1771-02-05',
    1772: '1772-01-26',
    1773: '1773-02-13',
    1774: '1774-02-02',
    1775: '1775-02-20',
    1776: '1776-02-09',
    1777: '1777-01-29',
    1778: '1778-02-17',
    1779: '1779-02-06',
    1780: '1780-01-27',
    1781: '1781-02-14',
    1782: '1782-02-03',
    1783: '1783-01-24',
    1784: '1784-02-12',
    1785: '1785-01-31',
    1786: '1786-02-19',
    1787: '1787-02-08',
    1788: '1788-01-28',
    1789: '1789-02-15',
    1790: '1790-02-05',
    1791: '1791-01-26',
    1792: '1792-02-13',
    1793: '1793-02-01',
    1794: '1794-02-20',
    1795: '1795-02-09',
    1796: '1796-01-30',
    1797: '1797-02-17',
    1798: '1798-02-06',
    1799: '1799-01-27',
    1800: '1800-02-14',
    1801: '1801-02-02',
    1802: '1802-01-23',
    1803: '1803-02-11',
    1804: '1804-01-31',
    1805: '1805-02-19',
    1806: '1806-02-08',
    1807: '1807-01-28',
    1808: '1808-02-16',
    1809: '1809-02-04',
    1810: '1810-01-25',
    1811: '1811-02-13',
    1812: '1812-02-02',
    1813: '1813-02-20',
    1814: '1814-02-09',
    1815: '1815-01-30',
    1816: '1816-02-17',
    1817: '1817-02-05',
    1818: '1818-01-26',
    1819: '1819-02-14',
    1820: '1820-02-03',
    1821: '1821-01-23',
    1822: '1822-02-11',
    1823: '1823-01-31',
    1824: '1824-02-19',
    1825: '1825-02-08',
    1826: '1826-01-28',
    1827: '1827-02-16',
    1828: '1828-02-05',
    1829: '1829-01-25',
    1830: '1830-02-13',
    1831: '1831-02-02',
    1832: '1832-02-21',
    1833: '1833-02-09',
    1834: '1834-01-30',
    1835: '1835-02-17',
    1836: '1836-02-06',
    1837: '1837-01-26',
    1838: '1838-02-14',
    1839: '1839-02-03',
    1840: '1840-01-24',
    1841: '1841-02-11',
    1842: '1842-01-31',
    1843: '1843-02-19',
    1844: '1844-02-08',
    1845: '1845-01-28',
    1846: '1846-02-16',
    1847: '1847-02-05',
    1848: '1848-01-26',
    1849: '1849-02-13',
    1850: '1850-02-02',
    1851: '1851-02-20',
    1852: '1852-02-09',
    1853: '1853-01-30',
    1854: '1854-02-17',
    1855: '1855-02-06',
    1856: '1856-01-27',
    1857: '1857-02-14',
    1858: '1858-02-03',
    1859: '1859-01-24',
    1860: '1860-02-12',
    1861: '1861-01-31',
    1862: '1862-02-19',
    1863: '1863-02-08',
    1864: '1864-01-28',
    1865: '1865-02-15',
    1866: '1866-02-05',
    1867: '1867-01-26',
    1868: '1868-02-13',
    1869: '1869-02-01',
    1870: '1870-02-20',
    1871: '1871-02-09',
    1872: '1872-01-30',
    1873: '1873-02-17',
    1874: '1874-02-06',
    1875: '1875-01-27',
    1876: '1876-02-14',
    1877: '1877-02-02',
    1878: '1878-01-23',
    1879: '1879-02-11',
    1880: '1880-01-31',
    1881: '1881-02-19',
    1882: '1882-02-08',
    1883: '1883-01-28',
    1884: '1884-02-16',
    1885: '1885-02-04',
    1886: '1886-01-25',
    1887: '1887-02-13',
    1888: '1888-02-02',
    1889: '1889-02-20',
    1890: '1890-02-09',
    1891: '1891-01-30',
    1892: '1892-02-17',
    1893: '1893-02-05',
    1894: '1894-01-26',
    1895: '1895-02-14',
    1896: '1896-02-03',
    1897: '1897-01-23',
    1898: '1898-02-11',
    1899: '1899-01-31',
    1900: '1900-01-31',
    1901: '1901-02-19',
    1902: '1902-02-08',
    1903: '1903-01-29',
    1904: '1904-02-16',
    1905: '1905-02-04',
    1906: '1906-01-25',
    1907: '1907-02-13',
    1908: '1908-02-02',
    1909: '1909-01-22',
    1910: '1910-02-10',
    1911: '1911-01-30',
    1912: '1912-02-18',
    1913: '1913-02-06',
    1914: '1914-01-26',
    1915: '1915-02-14',
    1916: '1916-02-03',
    1917: '1917-01-23',
    1918: '1918-02-11',
    1919: '1919-02-01',
    1920: '1920-02-20',
    1921: '1921-02-08',
    1922: '1922-01-28',
    1923: '1923-02-16',
    1924: '1924-02-05',
    1925: '1925-01-24',
    1926: '1926-02-13',
    1927: '1927-02-02',
    1928: '1928-01-23',
    1929: '1929-02-10',
    1930: '1930-01-30',
    1931: '1931-02-17',
    1932: '1932-02-06',
    1933: '1933-01-26',
    1934: '1934-02-14',
    1935: '1935-02-04',
    1936: '1936-01-24',
    1937: '1937-02-11',
    1938: '1938-01-31',
    1939: '1939-02-19',
    1940: '1940-02-08',
    1941: '1941-01-27',
    1942: '1942-02-15',
    1943: '1943-02-05',
    1944: '1944-01-25',
    1945: '1945-02-13',
    1946: '1946-02-02',
    1947: '1947-01-22',
    1948: '1948-02-10',
    1949: '1949-01-29',
    1950: '1950-02-17',
    1951: '1951-02-06',
    1952: '1952-01-27',
    1953: '1953-02-14',
    1954: '1954-02-03',
    1955: '1955-01-24',
    1956: '1956-02-12',
    1957: '1957-01-31',
    1958: '1958-02-18',
    1959: '1959-02-08',
    1960: '1960-01-28',
    1961: '1961-02-15',
    1962: '1962-02-05',
    1963: '1963-01-25',
    1964: '1964-02-13',
    1965: '1965-02-02',
    1966: '1966-01-21',
    1967: '1967-02-09',
    1968: '1968-01-30',
    1969: '1969-02-17',
    1970: '1970-02-06',
    1971: '1971-01-27',
    1972: '1972-02-15',
    1973: '1973-02-03',
    1974: '1974-01-23',
    1975: '1975-02-11',
    1976: '1976-01-31',
    1977: '1977-02-18',
    1978: '1978-02-07',
    1979: '1979-01-28',
    1980: '1980-02-16',
    1981: '1981-02-05',
    1982: '1982-01-25',
    1983: '1983-02-13',
    1984: '1984-02-02',
    1985: '1985-02-20',
    1986: '1986-02-09',
    1987: '1987-01-29',
    1988: '1988-02-17',
    1989: '1989-02-06',
    1990: '1990-01-27',
    1991: '1991-02-15',
    1992: '1992-02-04',
    1993: '1993-01-23',
    1994: '1994-02-10',
    1995: '1995-01-31',
    1996: '1996-02-19',
    1997: '1997-02-07',
    1998: '1998-01-28',
    1999: '1999-02-16',
    2000: '2000-02-05',
    2001: '2001-01-24',
    2002: '2002-02-12',
    2003: '2003-02-01',
    2004: '2004-01-22',
    2005: '2005-02-09',
    2006: '2006-01-29',
    2007: '2007-02-18',
    2008: '2008-02-07',
    2009: '2009-01-26',
    2010: '2010-02-14',
    2011: '2011-02-03',
    2012: '2012-01-23',
    2013: '2013-02-10',
    2014: '2014-01-31',
    2015: '2015-02-19',
    2016: '2016-02-08',
    2017: '2017-01-28',
    2018: '2018-02-16',
    2019: '2019-02-05',
    2020: '2020-01-25',
    2021: '2021-02-12',
    2022: '2022-02-01',
    2023: '2023-01-22',
    2024: '2024-02-10',
    2025: '2025-01-29'
                };
                chineseNewYears = {...presetDates, ...chineseNewYears};
                localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
            };
            
const estimateChineseNewYear = (year) => {
                const baseDate = new Date(year, 0, 21);
                const cycle = (year - 1900) % 19;
                return new Date(baseDate.setDate(21 + cycle));
            };

            const getZodiac = (date) => {
                const year = date.getFullYear();
                if(year < 1725 || year > 2100) throw new Error('A√±o fuera de rango');
                
                const cnDate = chineseNewYears[year] 
                    ? new Date(chineseNewYears[year]) 
                    : estimateChineseNewYear(year);

                if(!chineseNewYears[year]) {
                    chineseNewYears[year] = cnDate.toISOString().split('T')[0];
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
                }

                const zodiacYear = date < cnDate ? year - 1 : year;
                const zodiacIndex = ((zodiacYear - 1900) % 12 + 12) % 12;
                return {...zodiacData[zodiacIndex]};
            };

            const getDayZodiac = (date) => {
                const baseDate = new Date(1900, 0, 1);
                const diffDays = Math.floor((date - baseDate) / (86400000));
                return {...zodiacData[(diffDays % 12 + 12) % 12]};
            };

            const calculateCompatibility = (zodiacA, zodiacB) => {
                const getScore = (source, target) => {
                    if(source.best.includes(target.animal)) return 100;
                    if(source.good.includes(target.animal)) return 75;
                    if(source.avoid.includes(target.animal)) return 25;
                    return 50;
                };
                
                const score = (getScore(zodiacA, zodiacB) + getScore(zodiacB, zodiacA)) / 2;
                
                return {
                    score,
                    details: [
                        `${zodiacA.animal} ‚Üí ${zodiacB.animal}: ${getScore(zodiacA, zodiacB)}%`,
                        `${zodiacB.animal} ‚Üí ${zodiacA.animal}: ${getScore(zodiacB, zodiacA)}%`
                    ]
                };
            };

            const updateUI = (resultId, zodiac) => {
    // Asegurar nombres en espa√±ol con primera letra may√∫scula
    const formattedName = zodiac.animal.charAt(0).toUpperCase() + zodiac.animal.slice(1).toLowerCase();
    
    document.getElementById(`${resultId}-animal`).textContent = formattedName;
    document.getElementById(`${resultId}-chinese`).textContent = zodiac.chinese;
};

            const handleDateInput = (inputId, resultId) => {
                try {
                    const date = document.getElementById(inputId).value;
                    if(!date) return;
                    updateUI(resultId, getZodiac(new Date(date)));
                } catch(error) {
                    document.getElementById('errorMsg').textContent = error.message;
                    document.getElementById('errorMsg').style.display = 'block';
                }
            };

            // 2. CORRIGE LA FUNCI√ìN calculateNumerology PARA USAR numerologyData CORRECTAMENTE
        const calculateNumerology = (zodiac, dayNum, dateNum) => {
            const numbers = [dayNum, dateNum];
            let favorable = 0;
            
            numbers.forEach(n => {
                if (numerologyData[zodiac].best.includes(n)) favorable++;
                if (numerologyData[zodiac].avoid.includes(n)) favorable--;
            });
            
            const favorablePercentage = Math.max(0, Math.min(100, (favorable / 2) * 100));
            return {
                favorable: favorablePercentage,
                unfavorable: 100 - favorablePercentage
            };
        };
    
            const updateNumerology = () => {
            const meetingDate = document.getElementById('meetingDate').value;
            if (!meetingDate) return;

            const date = new Date(meetingDate);
            const dayNum = calculateDayNumber(date);
            const dateNum = calculateDateNumber(date);
            
           const zodiac1 = document.getElementById('zodiac-animal1').textContent.trim();
    const zodiac2 = document.getElementById('zodiac-animal2').textContent.trim();

    // Debug: Mostrar nombres en consola
    console.log("Zodiaco 1:", zodiac1);
    console.log("Zodiaco 2:", zodiac2);
    console.log("Claves en numerologyData:", Object.keys(numerologyData));

    if (!numerologyData[zodiac1]) {
        console.error(`"${zodiac1}" no existe en numerologyData. Opciones v√°lidas:`, Object.keys(numerologyData));
        return;
    }
    if (!numerologyData[zodiac2]) {
        console.error(`"${zodiac2}" no existe en numerologyData. Opciones v√°lidas:`, Object.keys(numerologyData));
        return;
    }
        

            const result1 = calculateNumerology(zodiac1, dayNum, dateNum);
            const result2 = calculateNumerology(zodiac2, dayNum, dateNum);

            // Actualizar UI
            document.getElementById('fav1').style.width = `${result1.favorable}%`;
            document.getElementById('unfav1').style.width = `${result1.unfavorable}%`;
            document.getElementById('fav2').style.width = `${result2.favorable}%`;
            document.getElementById('unfav2').style.width = `${result2.unfavorable}%`;

            document.getElementById('numerologyResult1').textContent = 
                `Favorable: ${result1.favorable.toFixed(1)}% | Desfavorable: ${result1.unfavorable.toFixed(1)}%`;
            
            document.getElementById('numerologyResult2').textContent = 
                `Favorable: ${result2.favorable.toFixed(1)}% | Desfavorable: ${result2.unfavorable.toFixed(1)}%`;
        };


function reduceToMasterNumber(num) {
    const masterNumbers = [11, 22, 33];
    if (masterNumbers.includes(num)) return num;
    
    while(num > 9) {
        num = num.toString().split('').reduce((a,b) => a + parseInt(b), 0);
        if (masterNumbers.includes(num)) break;
    }
    return num;
}

function calculateDayNumber(date) {
    const day = date.getDate();
    return reduceToMasterNumber(day);
}

function calculateDateNumber(date) {
    const digits = [
        date.getDate().toString().padStart(2, '0'),
        (date.getMonth() + 1).toString().padStart(2, '0'),
        date.getFullYear().toString()
    ].join('').split('').map(Number);
    
    return reduceToMasterNumber(digits.reduce((a,b) => a + b, 0));
}

                    
         // 3. A√ëADE VALIDACI√ìN DE DATOS EN handleComparison
        const handleComparison = () => {
            try {
                const zodiac1 = document.getElementById('zodiac-animal1').textContent.trim();
                const zodiac2 = document.getElementById('zodiac-animal2').textContent.trim();
                
                if (!numerologyData[zodiac1] || !numerologyData[zodiac2]) {
                    throw new Error('Error: Zodiacos no cargados correctamente. Recarga la p√°gina.');
                }e;
                    });

                const zodiacs = dates.map(date => getZodiac(new Date(date)));
                const meetingDayZodiac = getDayZodiac(new Date(dates[2]));

                const compatibilities = {
                    year1: calculateCompatibility(zodiacs[2], zodiacs[0]),
                    year2: calculateCompatibility(zodiacs[2], zodiacs[1]),
                    day1: calculateCompatibility(meetingDayZodiac, zodiacs[0]),
                    day2: calculateCompatibility(meetingDayZodiac, zodiacs[1])
                };

                Object.entries(compatibilities).forEach(([key, {score, details}]) => {
                    document.getElementById(`meter${key.replace(/^./, c => c.toUpperCase())}`).style.width = `${score}%`;
                    document.getElementById(`details${key.replace(/^./, c => c.toUpperCase())}`).innerHTML = `
                        <p>${score.toFixed(1)}% de compatibilidad</p>
                        <ul>${details.map(d => `<li>${d}</li>`).join('')}</ul>
                    `;
                });

                document.getElementById('comparisonResult').style.display = 'block';
                document.getElementById('errorMsg').style.display = 'none';
                updateNumerology(); // Llamada a numerolog√≠a aqu√≠

            } catch(error) {
                document.getElementById('errorMsg').textContent = error.message;
                document.getElementById('errorMsg').style.display = 'block';
            }
        };

        // ========== INICIALIZACI√ìN CORRECTA ==========
        if(!window.zodiacSystemInitialized) {
            initializeDatabase();
            document.getElementById('compareBtn').addEventListener('click', handleComparison); // Un solo evento
            document.querySelectorAll('.date-input').forEach(input => {
                input.addEventListener('change', e => handleDateInput(e.target.id, e.target.id.replace('birthdate', 'result')));
            });
            window.zodiacSystemInitialized = true;
        }

    })(); // <-- Este cierre estaba mal ubicado
</script>
</body>
</html>
