<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Zodiac Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.8.0/suncalc.js"></script>
    <style>
        /* (Keep existing CSS styles the same) */
    </style>
</head>
<body>
    <!-- (Keep existing HTML structure the same) -->
    <script>
        // (Keep zodiacData object the same)

        function getLunarNewYear(targetYear) {
            // Get December solstice of previous year
            const solsticeDate = SunCalc.getTimes(new Date(targetYear - 1, 11, 22), 0, 0).decSolstice;
            
            // Find subsequent new moons
            let newMoonCount = 0;
            let date = new Date(solsticeDate);
            let lunarNewYear = null;
            
            while (newMoonCount < 2) {
                date.setDate(date.getDate() + 1);
                const phase = SunCalc.getMoonIllumination(date).phase;
                if (phase < 0.01) { // New moon detection
                    newMoonCount++;
                    if (newMoonCount === 2) {
                        lunarNewYear = new Date(date);
                        // Adjust for traditional lunisolar rules
                        const feb4 = new Date(targetYear, 1, 4);
                        if (lunarNewYear > feb4) {
                            lunarNewYear.setMonth(lunarNewYear.getMonth() - 1);
                        }
                    }
                }
            }
            return lunarNewYear;
        }

        function getZodiac(inputDate) {
            const gregorianYear = inputDate.getFullYear();
            const lunarNewYear = getLunarNewYear(gregorianYear);
            const zodiacYear = inputDate < lunarNewYear ? gregorianYear - 1 : gregorianYear;
            
            // Adjust for 12-year cycle starting from 1984 (Rat year)
            const zodiacIndex = (zodiacYear - 1984) % 12;
            return Object.values(zodiacData)[zodiacIndex < 0 ? 12 + zodiacIndex : zodiacIndex];
        }

        function calculateZodiac() {
            const dateInput = document.getElementById('birthdate').value;
            if (!dateInput) return;
            
            const date = new Date(dateInput);
            const zodiac = getZodiac(date);
            
            // (Keep existing result display code the same)
        }
    </script>
</body>
</html>
