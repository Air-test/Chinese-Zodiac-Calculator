<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analizador ZodÃ­aco Chino Pro</title>
  <style>
    /* Variables de color actualizadas: azules, naranjas y blancos */
    :root {
      --primary: #cc5d14;       /* Azul principal */
      --secondary: #1484ca;     /* Naranja para acentos */
      --accent: #2980b9;        /* Azul acentuado (para barras y elementos destacados) */
      --background: #f7f9fc;    /* Fondo muy claro */
      --card-bg: #ffffff;       /* Fondo de tarjetas e inputs */
      --text-color: #333333;    /* Color de texto principal */
    }

    /* Reset bÃ¡sico y tipografÃ­a moderna */
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 5rem;
      background: var(--background);
      color: var(--text-color);
      line-height: 1.6;
    }

    h1, h2, h3, h4 {
      margin: 0 0 1rem;
      font-weight: 600;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      color: var(--primary);
    }

    /* Contenedores generales */
    .container,
    .compatibility-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* Estilo de tarjetas e inputs */
    .input-group, 
    .compatibility-card, 
    .numerology-group, 
    .comparison-section, 
    .numerology-section {
      background: var(--card-bg);
      padding: 3rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .input-group h3 {
      margin-bottom: 0.75rem;
      color: var(--primary);
    }

    input[type="date"] {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s;
    }

    input[type="date"]:focus {
      border-color: var(--primary);
    }

    /* BotÃ³n modernizado */
    button {
      display: inline-block;
      background: var(--secondary);
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #cf711c;
    }

    /* Mensaje de error */
    #errorMsg {
      color: #fff;
      background: var(--secondary);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 5px;
      display: none;
    }

    /* Barras de compatibilidad y numerologÃ­a */
    .compatibility-meter, .numerology-meter {
      height: 12px;
      background: #eee;
      border-radius: 6px;
      margin: 1rem 0;
      overflow: hidden;
    }
    
    .meter-fill {
      height: 100%;
      background: var(--accent);
      transition: width 0.5s ease;
    }
    
    .numerology-meter {
      background: #ffe6d5;
      position: relative;
    }
    
    .numerology-fill {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.5s ease;
    }

    /* SecciÃ³n NumerologÃ­a */
    .numerology-section h2 {
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .numerology-group h3 {
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    /* Ajustes para la secciÃ³n de compatibilidad */
    .comparison-section h2 {
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .compatibility-card h4 {
      margin-bottom: 0.75rem;
      color: var(--primary);
    }

    /* Ajustes generales para tarjetas internas */
    .compatibility-card p,
    .numerology-group p {
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <h1>Analizador ZodÃ­aco Chino Pro</h1>
  
  <div class="container" style="grid-template-columns: repeat(3, 1fr);">
    <div class="input-group">
      <h3>Equipo 1</h3>
      <input type="date" id="birthdate1" class="date-input" required>
      <div class="result" id="result1">
      </div>
    </div>
  
    <div class="input-group">
      <h3>Equipo 2</h3>
      <input type="date" id="birthdate2" class="date-input" required>
      <div class="result" id="result2">
      </div>
    </div>
  
    <div class="input-group">
      <h3>Fecha de Encuentro</h3>
      <input type="date" id="meetingDate" required>
    </div>
  </div>
  
  <div class="comparison-section">
    <h2>AnÃ¡lisis Avanzado</h2>
    
    <button type="button" id="compareBtn">Calcular Compatibilidad Completa</button>
    <div id="errorMsg"></div>
  
    <div id="comparisonResult" style="display: none;">
      <!-- Compatibilidad Anual -->
      <div class="compatibility-grid" style="grid-template-columns: repeat(2, 1fr);">
        <div class="compatibility-card">
          <h4>ðŸ“… Compatibilidad Anual con Equipo 1</h4>
          <div class="compatibility-meter">
            <div class="meter-fill" id="meterYear1"></div>
          </div>
          <div id="detailsYear1"></div>
        </div>
  
        <div class="compatibility-card">
          <h4>ðŸ“… Compatibilidad Anual con Equipo 2</h4>
          <div class="compatibility-meter">
            <div class="meter-fill" id="meterYear2"></div>
          </div>
          <div id="detailsYear2"></div>
        </div>
      </div>
  
      <!-- Compatibilidad Diaria -->
      <div class="compatibility-grid" style="grid-template-columns: repeat(2, 1fr);">
        <div class="compatibility-card">
          <h4>ðŸŒž DÃ­a vs Equipo 1</h4>
          <div class="compatibility-meter">
            <div class="meter-fill" id="meterDay1"></div>
          </div>
          <div id="detailsDay1"></div>
        </div>
  
        <div class="compatibility-card">
          <h4>ðŸŒ™ DÃ­a vs Equipo 2</h4>
          <div class="compatibility-meter">
            <div class="meter-fill" id="meterDay2"></div>
          </div>
          <div id="detailsDay2"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- SecciÃ³n NumerologÃ­a -->
  <div class="numerology-section">
    <h2>NumerologÃ­a</h2>
    
    <div class="numerology-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
      <div>
        <h3>DÃ­a</h3>
        <p id="numerology-day">-</p>
      </div>
      <div>
        <h3>Fecha</h3>
        <p id="numerology-date">-</p>
      </div>
    </div>
    
    <div class="compatibility-grid">
      <div class="compatibility-card">
        <h4>Equipo 1 â€“ <span id="numZodiac1">-</span></h4>
        <p id="numerology-analysis-text1">-</p>
        <div class="numerology-meter">
          <div class="numerology-fill" id="numerology-meter1"></div>
        </div>
      </div>
      <div class="compatibility-card">
        <h4>Equipo 2 â€“ <span id="numZodiac2">-</span></h4>
        <p id="numerology-analysis-text2">-</p>
        <div class="numerology-meter">
          <div class="numerology-fill" id="numerology-meter2"></div>
        </div>
      </div>
    </div>
  </div>
  

 

  <script>
    (function(){
      'use strict';
      
      const zodiacData = [
        { animal: 'Rata', chinese: 'é¼  (ShÇ”)', best: ['DragÃ³n', 'Buey', 'Conejo' , '2', '3'], good: ['Mono','Tigre',  'Serpiente', 'Cerdo', 'Perro','Rata'], avoid: ['Caballo', 'Cabra', 'Gallo', '5', '9'] },
        { animal: 'Buey', chinese: 'ç‰› (NiÃº)', best: [ 'Mono', 'Gallo','Rata','1','4'], good: [ 'Conejo','Serpiente', 'Perro', 'Buey'], avoid: ['Tigre', 'Cabra', 'Caballo', 'Cerdo', 'DragÃ³n','5','6' ] },
        { animal: 'Tigre', chinese: 'è™Ž (HÇ”)', best: ['Caballo','DragÃ³n', 'Cerdo','1','3','4'], good: ['Rata', 'Conejo', 'Cabra', 'Perro',  'Gallo'], avoid: ['Mono', 'Tigre', 'Buey',  'Serpiente','6','7','8'] },
        { animal: 'Conejo', chinese: 'å…” (TÃ¹)', best: ['Rata','Cabra', 'Cerdo', 'Perro', 'Mono','3','4','6'], good: [ 'Buey', 'Tigre', 'Conejo', 'DragÃ³n', 'Caballo'], avoid: ['Gallo', 'Serpiente','1','7','8'] },
        { animal: 'DragÃ³n', chinese: 'é¾™ (LÃ³ng)', best: ['Tigre','Rata', 'Serpiente','1','6','7'], good: [ 'Conejo', 'Caballo', 'Gallo', 'Perro', 'Cerdo',  'Mono'], avoid: ['Perro', 'Cabra', 'Buey','3','8'] },
        { animal: 'Serpiente', chinese: 'è›‡ (ShÃ©)', best: [ 'Gallo', 'DragÃ³n','2','8','9'], good: ['Buey','Rata', 'Caballo', 'Mono','Perro'], avoid: ['Cerdo', 'Tigre', 'Conejo', 'Cabra', 'Serpiente','1','6' ,'7'] },
        { animal: 'Caballo', chinese: 'é©¬ (MÇŽ)', best: ['Tigre', 'Cabra','2','3','7'], good: ['DragÃ³n', 'Serpiente', 'Mono', 'Cerdo', 'Conejo', 'Perro'], avoid: ['Rata', 'Buey', 'Gallo', 'Caballo','1','5','6'] },
        { animal: 'Cabra', chinese: 'ç¾Š (YÃ¡ng)', best: ['Conejo', 'Cerdo', 'Caballo','2','7'], good: ['Tigre', 'Mono', 'Gallo', 'Cabra'], avoid: ['Buey', 'Rata', 'DragÃ³n', 'Serpiente', 'Perro','4','9'] },
        { animal: 'Mono', chinese: 'çŒ´ (HÃ³u)', best: ['Buey', 'Conejo','4','9'], good: ['Serpiente', 'Caballo', 'Cabra', 'Perro', 'Rata', 'DragÃ³n','Mono','Gallo'], avoid: ['Tigre', 'Cerdo','2','7'] },
        { animal: 'Gallo', chinese: 'é¸¡ (JÄ«)', best: ['Buey', 'Serpiente','5','7','8'], good: ['Tigre', 'DragÃ³n', 'Cabra', 'Mono', 'Cerdo'], avoid: ['Conejo', 'Gallo', 'Perro', 'Conejo', 'Caballo','1','3','9'] },
        { animal: 'Perro', chinese: 'ç‹— (GÇ’u)', best: ['Conejo','3','4','9'], good: ['Rata', 'Serpiente', 'Mono', 'Cerdo', 'Tigre', 'Caballo', 'Perro'], avoid: ['DragÃ³n', 'Buey', 'Cabra', 'Gallo','1','6','7'] },
        { animal: 'Cerdo', chinese: 'çŒª (ZhÅ«)', best: ['Tigre','Conejo', 'Cabra','2','5','8'], good: ['Rata',  'DragÃ³n', 'Gallo', 'Perro', 'Cerdo', 'Caballo'], avoid: ['Serpiente', 'Buey', 'Mono','1','7'] }
      ];

      const STORAGE_KEY = 'chineseNewYearsData';
      let chineseNewYears = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

      const initializeDatabase = () => {
        const presetDates = {
            1724: '1724-02-14',
            1725: '1725-02-03',
            1726: '1726-01-24',
            1727: '1727-02-11',
            1728: '1728-02-01',
            1729: '1729-02-19',
            1730: '1730-02-08',
            1731: '1731-01-28',
            1732: '1732-02-16',
            1733: '1733-02-05',
            1734: '1734-01-26',
            1735: '1735-02-13',
            1736: '1736-02-02',
            1737: '1737-02-20',
            1738: '1738-02-09',
            1739: '1739-01-30',
            1740: '1740-02-18',
            1741: '1741-02-06',
            1742: '1742-01-27',
            1743: '1743-02-15',
            1744: '1744-02-04',
            1745: '1745-01-24',
            1746: '1746-02-12',
            1747: '1747-02-01',
            1748: '1748-02-20',
            1749: '1749-02-08',
            1750: '1750-01-29',
            1751: '1751-02-16',
            1752: '1752-02-05',
            1753: '1753-01-25',
            1754: '1754-02-13',
            1755: '1755-02-02',
            1756: '1756-02-21',
            1757: '1757-02-09',
            1758: '1758-01-30',
            1759: '1759-02-17',
            1760: '1760-02-06',
            1761: '1761-01-26',
            1762: '1762-02-14',
            1763: '1763-02-03',
            1764: '1764-01-24',
            1765: '1765-02-11',
            1766: '1766-01-31',
            1767: '1767-02-19',
            1768: '1768-02-08',
            1769: '1769-01-28',
            1770: '1770-02-16',
            1771: '1771-02-05',
            1772: '1772-01-26',
            1773: '1773-02-13',
            1774: '1774-02-02',
            1775: '1775-02-20',
            1776: '1776-02-09',
            1777: '1777-01-29',
            1778: '1778-02-17',
            1779: '1779-02-06',
            1780: '1780-01-27',
            1781: '1781-02-14',
            1782: '1782-02-03',
            1783: '1783-01-24',
            1784: '1784-02-12',
            1785: '1785-01-31',
            1786: '1786-02-19',
            1787: '1787-02-08',
            1788: '1788-01-28',
            1789: '1789-02-15',
            1790: '1790-02-05',
            1791: '1791-01-26',
            1792: '1792-02-13',
            1793: '1793-02-01',
            1794: '1794-02-20',
            1795: '1795-02-09',
            1796: '1796-01-30',
            1797: '1797-02-17',
            1798: '1798-02-06',
            1799: '1799-01-27',
            1800: '1800-02-14',
            1801: '1801-02-02',
            1802: '1802-01-23',
            1803: '1803-02-11',
            1804: '1804-01-31',
            1805: '1805-02-19',
            1806: '1806-02-08',
            1807: '1807-01-28',
            1808: '1808-02-16',
            1809: '1809-02-04',
            1810: '1810-01-25',
            1811: '1811-02-13',
            1812: '1812-02-02',
            1813: '1813-02-20',
            1814: '1814-02-09',
            1815: '1815-01-30',
            1816: '1816-02-17',
            1817: '1817-02-05',
            1818: '1818-01-26',
            1819: '1819-02-14',
            1820: '1820-02-03',
            1821: '1821-01-23',
            1822: '1822-02-11',
            1823: '1823-01-31',
            1824: '1824-02-19',
            1825: '1825-02-08',
            1826: '1826-01-28',
            1827: '1827-02-16',
            1828: '1828-02-05',
            1829: '1829-01-25',
            1830: '1830-02-13',
            1831: '1831-02-02',
            1832: '1832-02-21',
            1833: '1833-02-09',
            1834: '1834-01-30',
            1835: '1835-02-17',
            1836: '1836-02-06',
            1837: '1837-01-26',
            1838: '1838-02-14',
            1839: '1839-02-03',
            1840: '1840-01-24',
            1841: '1841-02-11',
            1842: '1842-01-31',
            1843: '1843-02-19',
            1844: '1844-02-08',
            1845: '1845-01-28',
            1846: '1846-02-16',
            1847: '1847-02-05',
            1848: '1848-01-26',
            1849: '1849-02-13',
            1850: '1850-02-02',
            1851: '1851-02-20',
            1852: '1852-02-09',
            1853: '1853-01-30',
            1854: '1854-02-17',
            1855: '1855-02-06',
            1856: '1856-01-27',
            1857: '1857-02-14',
            1858: '1858-02-03',
            1859: '1859-01-24',
            1860: '1860-02-12',
            1861: '1861-01-31',
            1862: '1862-02-19',
            1863: '1863-02-08',
            1864: '1864-01-28',
            1865: '1865-02-15',
            1866: '1866-02-05',
            1867: '1867-01-26',
            1868: '1868-02-13',
            1869: '1869-02-01',
            1870: '1870-02-20',
            1871: '1871-02-09',
            1872: '1872-01-30',
            1873: '1873-02-17',
            1874: '1874-02-06',
            1875: '1875-01-27',
            1876: '1876-02-14',
            1877: '1877-02-02',
            1878: '1878-01-23',
            1879: '1879-02-11',
            1880: '1880-01-31',
            1881: '1881-02-19',
            1882: '1882-02-08',
            1883: '1883-01-28',
            1884: '1884-02-16',
            1885: '1885-02-04',
            1886: '1886-01-25',
            1887: '1887-02-13',
            1888: '1888-02-02',
            1889: '1889-02-20',
            1890: '1890-02-09',
            1891: '1891-01-30',
            1892: '1892-02-17',
            1893: '1893-02-05',
            1894: '1894-01-26',
            1895: '1895-02-14',
            1896: '1896-02-03',
            1897: '1897-01-23',
            1898: '1898-02-11',
            1899: '1899-01-31',
            1900: '1900-01-31',
            1901: '1901-02-19',
            1902: '1902-02-08',
            1903: '1903-01-29',
            1904: '1904-02-16',
            1905: '1905-02-04',
            1906: '1906-01-25',
            1907: '1907-02-13',
            1908: '1908-02-02',
            1909: '1909-01-22',
            1910: '1910-02-10',
            1911: '1911-01-30',
            1912: '1912-02-18',
            1913: '1913-02-06',
            1914: '1914-01-26',
            1915: '1915-02-14',
            1916: '1916-02-03',
            1917: '1917-01-23',
            1918: '1918-02-11',
            1919: '1919-02-01',
            1920: '1920-02-20',
            1921: '1921-02-08',
            1922: '1922-01-28',
            1923: '1923-02-16',
            1924: '1924-02-05',
            1925: '1925-01-24',
            1926: '1926-02-13',
            1927: '1927-02-02',
            1928: '1928-01-23',
            1929: '1929-02-10',
            1930: '1930-01-30',
            1931: '1931-02-17',
            1932: '1932-02-06',
            1933: '1933-01-26',
            1934: '1934-02-14',
            1935: '1935-02-04',
            1936: '1936-01-24',
            1937: '1937-02-11',
            1938: '1938-01-31',
            1939: '1939-02-19',
            1940: '1940-02-08',
            1941: '1941-01-27',
            1942: '1942-02-15',
            1943: '1943-02-05',
            1944: '1944-01-25',
            1945: '1945-02-13',
            1946: '1946-02-02',
            1947: '1947-01-22',
            1948: '1948-02-10',
            1949: '1949-01-29',
            1950: '1950-02-17',
            1951: '1951-02-06',
            1952: '1952-01-27',
            1953: '1953-02-14',
            1954: '1954-02-03',
            1955: '1955-01-24',
            1956: '1956-02-12',
            1957: '1957-01-31',
            1958: '1958-02-18',
            1959: '1959-02-08',
            1960: '1960-01-28',
            1961: '1961-02-15',
            1962: '1962-02-05',
            1963: '1963-01-25',
            1964: '1964-02-13',
            1965: '1965-02-02',
            1966: '1966-01-21',
            1967: '1967-02-09',
            1968: '1968-01-30',
            1969: '1969-02-17',
            1970: '1970-02-06',
            1971: '1971-01-27',
            1972: '1972-02-15',
            1973: '1973-02-03',
            1974: '1974-01-23',
            1975: '1975-02-11',
            1976: '1976-01-31',
            1977: '1977-02-18',
            1978: '1978-02-07',
            1979: '1979-01-28',
            1980: '1980-02-16',
            1981: '1981-02-05',
            1982: '1982-01-25',
            1983: '1983-02-13',
            1984: '1984-02-02',
            1985: '1985-02-20',
            1986: '1986-02-09',
            1987: '1987-01-29',
            1988: '1988-02-17',
            1989: '1989-02-06',
            1990: '1990-01-27',
            1991: '1991-02-15',
            1992: '1992-02-04',
            1993: '1993-01-23',
            1994: '1994-02-10',
            1995: '1995-01-31',
            1996: '1996-02-19',
            1997: '1997-02-07',
            1998: '1998-01-28',
            1999: '1999-02-16',
            2000: '2000-02-05',
            2001: '2001-01-24',
            2002: '2002-02-12',
            2003: '2003-02-01',
            2004: '2004-01-22',
            2005: '2005-02-09',
            2006: '2006-01-29',
            2007: '2007-02-18',
            2008: '2008-02-07',
            2009: '2009-01-26',
            2010: '2010-02-14',
            2011: '2011-02-03',
            2012: '2012-01-23',
            2013: '2013-02-10',
            2014: '2014-01-31',
            2015: '2015-02-19',
            2016: '2016-02-08',
            2017: '2017-01-28',
            2018: '2018-02-16',
            2019: '2019-02-05',
            2020: '2020-01-25',
            2021: '2021-02-12',
            2022: '2022-02-01',
            2023: '2023-01-22',
            2024: '2024-02-10',
            2025: '2025-01-29'
        };
        chineseNewYears = { ...presetDates, ...chineseNewYears };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
      };

      const estimateChineseNewYear = (year) => {
        const baseDate = new Date(year, 0, 21);
        const cycle = (year - 1900) % 19;
        return new Date(baseDate.setDate(21 + cycle));
      };

      const getZodiac = (date) => {
        const year = date.getFullYear();
        if(year < 1725 || year > 2100) throw new Error('AÃ±o fuera de rango');
        
        const cnDate = chineseNewYears[year] 
            ? new Date(chineseNewYears[year]) 
            : estimateChineseNewYear(year);

        if(!chineseNewYears[year]) {
          chineseNewYears[year] = cnDate.toISOString().split('T')[0];
          localStorage.setItem(STORAGE_KEY, JSON.stringify(chineseNewYears));
        }

        const zodiacYear = date < cnDate ? year - 1 : year;
        const zodiacIndex = ((zodiacYear - 1900) % 12 + 12) % 12;
        return { ...zodiacData[zodiacIndex] };
      };

      // FunciÃ³n para obtener el "zodiaco diario" (segÃºn dÃ­as transcurridos desde 1900/01/01)
      const getDayZodiac = (date) => {
        const baseDate = new Date(1900, 0, 1);
        const diffDays = Math.floor((date - baseDate) / (86400000));
        return { ...zodiacData[(diffDays % 12 + 12) % 12] };
      };

      const calculateCompatibility = (zodiacA, zodiacB) => {
        const getScore = (source, target) => {
          if(source.best.includes(target.animal)) return 100;
          if(source.good.includes(target.animal)) return 75;
          if(source.avoid.includes(target.animal)) return 25;
          return 50;
        };
        
        const score = (getScore(zodiacA, zodiacB) + getScore(zodiacB, zodiacA)) / 2;
        
        return {
          score,
          details: [
            `${zodiacA.animal} â†’ ${zodiacB.animal}: ${getScore(zodiacA, zodiacB)}%`,
            `${zodiacB.animal} â†’ ${zodiacA.animal}: ${getScore(zodiacB, zodiacA)}%`
          ]
        };
      };

      const updateUI = (resultId, zodiac) => {
        document.getElementById(`${resultId}-animal`).textContent = zodiac.animal;
        document.getElementById(`${resultId}-chinese`).textContent = zodiac.chinese;
      };

      const handleDateInput = (inputId, resultId) => {
        try {
          const dateVal = document.getElementById(inputId).value;
          if(!dateVal) return;
          updateUI(resultId, getZodiac(new Date(dateVal)));
        } catch(error) {
          document.getElementById('errorMsg').textContent = error.message;
          document.getElementById('errorMsg').style.display = 'block';
        }
      };

      // FunciÃ³n auxiliar para sumar dÃ­gitos
      const sumDigits = (str) => {
        return str.split('').reduce((acc, char) => {
          const n = parseInt(char, 10);
          return acc + (isNaN(n) ? 0 : n);
        }, 0);
      };

      // Los nÃºmeros "vÃ¡lidos" son: 1,2,3,4,5,6,7,8,9,10,11,22,33.
      // Se sigue sumando hasta obtener uno de estos valores, exceptuando 11, 22 y 33.
      const calculateNumerologyValue = (digitString) => {
        let total = sumDigits(digitString);
        // Si total es 11,22,33 o es de 1 dÃ­gito (o 10) ya estÃ¡ en la lista.
        const valid = [1,2,3,4,5,6,7,8,9,10,11,22,33];
        while(total > 9 && ![11,22,33,10].includes(total) && !valid.includes(total)) {
          total = sumDigits(total.toString());
        }
        return total;
      };

      // FunciÃ³n para obtener los dos valores de numerologÃ­a: DÃ­a y Fecha.
      // Se utiliza el valor exacto del input (YYYY-MM-DD) sin conversiÃ³n de zona horaria.
      const getNumerologyValues = (dateStr) => {
        // dateStr tiene formato "YYYY-MM-DD"
        const year = dateStr.substr(0,4);
        const month = dateStr.substr(5,2);
        const day = dateStr.substr(8,2);
        // "DÃ­a": se usan sÃ³lo los dÃ­gitos del dÃ­a.
        const numDia = calculateNumerologyValue(day);
        // "Fecha": se suman los dÃ­gitos en el orden dd/mm/aaaa.
        const fullDigits = day + month + year;
        const numFecha = calculateNumerologyValue(fullDigits);
        return { numDia, numFecha };
      };

      // FunciÃ³n para analizar la NumerologÃ­a en relaciÃ³n al zodiaco de cada fecha.
      // Se cuenta cada uno de los 2 nÃºmeros: si se encuentra en la propiedad "best" del objeto zodiac, se cuenta como favorable;
      // de lo contrario se cuenta como no favorable.
      const analyzeNumerologyForZodiac = (zodiac, numDia, numFecha) => {
        let favorable = 0;
        [numDia, numFecha].forEach(num => {
          if(zodiac.best.includes(num.toString())) {
            favorable++;
          } else {
            favorable++; // En este ejemplo se considera que si no estÃ¡ en "best" se cuenta como "no favorable"
            // TambiÃ©n se podrÃ­a diferenciar contando solo si estÃ¡ en "avoid", segÃºn se requiera.
          }
        });
        // En este ejemplo, asignamos un porcentaje favorable en base a cuÃ¡ntos de los 2 nÃºmeros estÃ¡n en "best".
        // Si ambos (2 de 2) estÃ¡n en "best": 100%, si ninguno: 0% y si sÃ³lo uno: 50%.
        // (Se asume que cada nÃºmero no favorable representa el complemento hasta 100%.)
        // Para este ejemplo, usaremos:
        const favorableCount = [numDia, numFecha].filter(num => zodiac.best.includes(num.toString())).length;
        const percentFavorable = (favorableCount / 2) * 100;
        const percentNonFavorable = 100 - percentFavorable;
        return { percentFavorable, percentNonFavorable, favorableCount };
      };

      const updateNumerologyUI = () => {
        const meetingDateStr = document.getElementById('meetingDate').value;
        if(!meetingDateStr) return;  // Si no se selecciona fecha de encuentro, no se actualiza
        const { numDia, numFecha } = getNumerologyValues(meetingDateStr);
        document.getElementById('numerology-day').textContent = `NÃºmero del DÃ­a: ${numDia}`;
        document.getElementById('numerology-date').textContent = `NÃºmero de la Fecha: ${numFecha}`;

        // Se analizan los nÃºmeros respecto a cada fecha zodiacal (Equipo 1 y Equipo 2)
        const bd1 = document.getElementById('birthdate1').value;
        const bd2 = document.getElementById('birthdate2').value;
        if(!bd1 || !bd2) return;
        const zodiac1 = getZodiac(new Date(bd1));
        const zodiac2 = getZodiac(new Date(bd2));
        
        document.getElementById('numZodiac1').textContent = zodiac1.animal;
        document.getElementById('numZodiac2').textContent = zodiac2.animal;
        
        const analysis1 = analyzeNumerologyForZodiac(zodiac1, numDia, numFecha);
        const analysis2 = analyzeNumerologyForZodiac(zodiac2, numDia, numFecha);
        
        document.getElementById('numerology-analysis-text1').textContent =
          `Favorables: ${analysis1.percentFavorable}% - No favorables: ${analysis1.percentNonFavorable}%`;
        document.getElementById('numerology-analysis-text2').textContent =
          `Favorables: ${analysis2.percentFavorable}% - No favorables: ${analysis2.percentNonFavorable}%`;
        
        // Actualizamos las barras: el div ".numerology-fill" se llena en verde segÃºn el porcentaje favorable.
        document.getElementById('numerology-meter1').style.width = `${analysis1.percentFavorable}%`;
        document.getElementById('numerology-meter2').style.width = `${analysis2.percentFavorable}%`;
      };

      const handleComparison = () => {
        try {
          // Se requieren las 3 fechas: Equipo 1, Equipo 2 y Fecha de Encuentro
          const dates = ['birthdate1', 'birthdate2', 'meetingDate']
            .map(id => {
              const val = document.getElementById(id).value;
              if(!val) throw new Error('Todos los campos son requeridos');
              return val;
            });
          
          // Se obtiene el zodiaco segÃºn la funciÃ³n existente.
          const zodiacs = dates.map(dateStr => getZodiac(new Date(dateStr)));
          const meetingDayZodiac = getDayZodiac(new Date(dates[2]));

          const compatibilities = {
            year1: calculateCompatibility(zodiacs[2], zodiacs[0]),
            year2: calculateCompatibility(zodiacs[2], zodiacs[1]),
            day1: calculateCompatibility(meetingDayZodiac, zodiacs[0]),
            day2: calculateCompatibility(meetingDayZodiac, zodiacs[1])
          };

          Object.entries(compatibilities).forEach(([key, {score, details}]) => {
            // Ejemplo: meterYear1, meterDay2, etc.
            const meterId = `meter${key.replace(/^./, c => c.toUpperCase())}`;
            document.getElementById(meterId).style.width = `${score}%`;
            const detailsId = `details${key.replace(/^./, c => c.toUpperCase())}`;
            document.getElementById(detailsId).innerHTML = `
              <p>${score.toFixed(1)}% de compatibilidad</p>
              <ul>${details.map(d => `<li>${d}</li>`).join('')}</ul>
            `;
          });

          document.getElementById('comparisonResult').style.display = 'block';
          document.getElementById('errorMsg').style.display = 'none';

          // Actualizamos tambiÃ©n la secciÃ³n de NumerologÃ­a
          updateNumerologyUI();

        } catch(error) {
          document.getElementById('errorMsg').textContent = error.message;
          document.getElementById('errorMsg').style.display = 'block';
        }
      };

      if(!window.zodiacSystemInitialized) {
        initializeDatabase();
        document.getElementById('compareBtn').addEventListener('click', handleComparison);
        document.querySelectorAll('.date-input').forEach(input => {
          input.addEventListener('change', e => {
            // Para los inputs de fecha de nacimiento se actualiza la secciÃ³n correspondiente.
            handleDateInput(e.target.id, e.target.id.replace('birthdate', 'result'));
          });
        });
        window.zodiacSystemInitialized = true;
      }
    })();
  </script>
</body>
</html>
